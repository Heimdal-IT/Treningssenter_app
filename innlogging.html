
<DOCTYPE! html>
<html>
  <body>
        <div class="container">
        <input id="txtEmail" type="email" placeholder="Email">
        <br>
        <input id="txtPassword" type="password" placeholder="Password">
        <br>
        <br>
        <br>
        <button id="btnLogin" class="btn btn-action">Log in</button>
        <br>
        <button id="btnSignup" class="btn btn-secondary" >Sign up</button>
        <br>
        <button id="btnLogout" class="btn btn-action">Log out</button>
        <br><br>
        <input id="dato" type="date" placeholder="Dato">
        <br>
        <input id="tid" type="time" placeholder="Klokkeslett">
        <br><br>
        <input submit type="submit" onclick="submit_data()" value="Send inn!" id="submitknapp">
        <input submit type="submit" onclick="slett_data()" value="Slett" id="slettknapp">     
        </div>
      
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>
        
        <script>
            
    // https://firebase.google.com/docs/reference/js/firebase.User
            
    // Sett inn rikgit kode osv... 
        var firebaseConfig = {
        apiKey: "AIzaSyAsgnjdnx1rAu9HdKZhp4yc2IZMod6t5sI",
        authDomain: "bibliotek-578f0.firebaseapp.com",
        databaseURL: "https://bibliotek-578f0.firebaseio.com",
        projectId: "bibliotek-578f0",
        storageBucket: "bibliotek-578f0.appspot.com",
        messagingSenderId: "1098565713208",
        appId: "1:1098565713208:web:1fb72f3b26fc9ee3aa15cd"
    };
    // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
    //Henter elementer
        const txtEmail = document.getElementById('txtEmail');
        const txtPassword = document.getElementById('txtPassword');
        const btnLogin = document.getElementById('btnLogin');
        const btnSignup = document.getElementById('btnSignup');
        const btnLogout = document.getElementById('btnLogout');
        const dato = document.getElementById('dato');
        const tid = document.getElementById('tid');
        
    //Login event
        btnLogin.addEventListener('click', e => {   
        
    //Email og passord, log inn
        const email = txtEmail.value;
        const pass = txtPassword.value;
        const auth = firebase.auth();
        
    //Log inn
        const promise = auth.signInWithEmailAndPassword(email,pass);
        promise.catch(e => console.log(e.message));
    });

    //Signup event
        btnSignup.addEventListener('click', e => {
            
    //Email og passord, registrer
        const email = txtEmail.value;
        const pass = txtPassword.value;
        const auth = firebase.auth();
        
    //Registrer
        const promise = auth.createUserWithEmailAndPassword(email,pass);
        promise.catch(e => window.alert(e.message));  
    });
    //Log ut      
        btnLogout.addEventListener('click', e => {
        firebase.auth().signOut();
    });
        
        
    //Real time listener, til database
        firebase.auth().onAuthStateChanged(firebaseUser => {

            if(firebaseUser) {
                console.log(firebaseUser);
                document.getElementById("btnLogout").style.display = "block";
                document.getElementById("dato").style.display = "block";
                document.getElementById("tid").style.display = "block";
                document.getElementById("submitknapp").style.display = "block";
                document.getElementById("slettknapp").style.display = "block";
                
        }   else {
                console.log('not logged in');
                document.getElementById("btnLogout").style.display = "none";
                document.getElementById("dato").style.display = "none";
                document.getElementById("tid").style.display = "none";
                document.getElementById("submitknapp").style.display = "none";
                document.getElementById("slettknapp").style.display = "none";
        }
        });

        // Returnerer referansen av type Firebase.Database.Reference
                function get_obj(){
                    var database = firebase.database();
                    let bibliotek = database.ref("bibliotek");
                    const dato_in = document.getElementById("dato").value;
                    const tid_in = document.getElementById("tid").value;
                    return bibliotek.child(dato_in+"-"+tid_in); 
        }
            
        // Sletter db objekt
                function slett_data(){
                    var new_object = get_obj()
                    new_object.remove()
                    const dato_in = document.getElementById("dato").value;
                    const tid_in = document.getElementById("tid").value;
                    window.alert("Du har slettet timen på "+dato_in+" klokken "+tid_in)
        }

        // Legger til db objekt
                function submit_data(){
                    var new_object = get_obj()
                    const dato_in = document.getElementById("dato").value;
                    const tid_in = document.getElementById("tid").value;
                    const userEmail = firebase.auth().currentUser.email;
                    new_object.set({
                        Dato : dato_in , 
                        Klokkeslett : tid_in ,
                        Email : userEmail 
                });
                    window.alert("Du har reservert time på " + dato_in+" klokken " +tid_in);
        }
      </script>
  </body>
</html>